<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fitness Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }
        
        /* Full-screen camera container */
        .camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        
        #canvas {
            display: none;
        }
        
        /* Overlay system */
        .overlay {
            position: fixed;
            width: 100%;
            z-index: 10;
            pointer-events: none;
        }
        
        .overlay * {
            pointer-events: auto;
        }
        
        /* Top status bar */
        .top-overlay {
            top: 0;
            padding: 50px 20px 20px 20px;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 100%);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }
        
        .time {
            font-variant-numeric: tabular-nums;
        }
        
        .profile-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        /* Calorie progress bar */
        .calorie-progress {
            margin-top: 15px;
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 12px 16px;
            backdrop-filter: blur(10px);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .progress-title {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        
        .progress-numbers {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 62%; /* This will be dynamic */
        }
        
        /* Bottom card overlay */
        .bottom-overlay {
            bottom: 0;
            padding: 0 20px 40px 20px;
        }
        
        .info-card {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .info-card.visible {
            transform: translateY(0);
        }
        
        .card-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-content {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 12px;
        }
        
        .nutrition-item {
            text-align: center;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        .nutrition-value {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        .nutrition-label {
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            margin-top: 2px;
        }
        
        /* Voice button */
        .voice-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.15);
            border: 3px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            font-size: 24px;
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }
        
        .voice-button:active {
            transform: scale(0.95);
            background: rgba(255,0,0,0.3);
        }
        
        .voice-button.listening {
            background: rgba(255,0,0,0.5);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Bottom navigation */
        .bottom-nav {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 16px 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s ease;
            user-select: none;
        }
        
        .nav-item.active {
            color: #4ade80;
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* Auth screen overlay */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .auth-title {
            color: white;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.9);
            font-size: 16px;
            color: #333;
        }
        
        .auth-button {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .auth-button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .auth-link {
            text-align: center;
            margin-top: 15px;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        
        .auth-link a {
            color: white;
            text-decoration: none;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }

        /* Profile grid styling */
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .profile-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .profile-label {
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            margin-bottom: 4px;
        }

        .profile-value {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .logout-button {
            margin-top: 16px;
            padding: 12px 24px;
            background: rgba(255,0,0,0.2);
            border: 1px solid rgba(255,0,0,0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }
        
        /* Responsive adjustments */
        @media (max-height: 700px) {
            .top-overlay {
                padding: 40px 20px 15px 20px;
            }
            
            .voice-button {
                width: 70px;
                height: 70px;
                font-size: 20px;
            }
        }

        /* Profile page specific styles */
        .profile-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .profile-section:last-of-type {
            border-bottom: none;
        }

        .section-title {
            color: rgba(255,255,255,0.9);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-avatar {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-email {
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }

        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .goal-section {
            text-align: center;
        }

        .goal-label {
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .goal-badge {
            display: inline-block;
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: capitalize;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .profile-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .auth-button.secondary {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .auth-button.danger {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .auth-button.danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Progress page specific styles */
        .progress-page {
            max-height: 90vh;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .progress-section {
            margin-bottom: 20px;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .energy-balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .energy-balance-main {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .time-indicator {
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }

        .progress-bar-container {
            margin: 15px 0;
        }

        .progress-bar-full {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            position: relative;
            overflow: visible;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
            position: relative;
            transition: width 0.8s ease-out;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        .typical-marker {
            position: absolute;
            top: -2px;
            width: 12px;
            height: 12px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: translateX(-50%);
        }

        .macro-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .macro-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .macro-info {
            flex: 1;
        }

        .macro-name {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }

        .macro-description {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        .macro-progress {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .circular-progress {
            position: relative;
            width: 50px;
            height: 50px;
        }

        .circular-progress svg {
            transform: rotate(-90deg);
        }

        .circular-progress-bg {
            fill: none;
            stroke: rgba(255,255,255,0.2);
            stroke-width: 3;
        }

        .circular-progress-fill {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            transition: stroke-dasharray 0.8s ease-out;
        }

        .circular-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        .macro-values {
            text-align: right;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .linear-progress {
            width: 80px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .linear-progress-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.8s ease-out;
        }

        .exercise-list {
            margin-top: 15px;
        }

        .exercise-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .exercise-item:last-child {
            border-bottom: none;
        }

        .exercise-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .exercise-icon {
            font-size: 20px;
        }

        .exercise-details h4 {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .exercise-meta {
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-calories {
            color: #f59e0b;
            font-weight: 600;
            font-size: 14px;
        }

        .pr-badge {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .streak-container {
            text-align: center;
        }

        .current-streak {
            font-size: 32px;
            font-weight: 700;
            color: #f59e0b;
            margin: 10px 0;
        }

        .streak-fires {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
        }

        .fire-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .fire-icon.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .fire-icon.inactive {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.4);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin: 20px 0;
        }

        .calendar-header {
            text-align: center;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            font-weight: 600;
            padding: 8px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .calendar-day.completed {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .calendar-day.incomplete {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
        }

        .calendar-day.today {
            border: 2px solid #06b6d4;
        }

        .motivation-quote {
            text-align: center;
            font-style: italic;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            line-height: 1.4;
            margin-top: 15px;
        }

    </style>
</head>
<body>
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-container">
            <div id="register-form">
                <h2 class="auth-title">Create Account</h2>
                <div class="form-group">
                    <input type="text" id="reg-username" class="form-input" placeholder="Username">
                </div>
                <div class="form-group">
                    <input type="number" id="reg-age" class="form-input" placeholder="Age">
                </div>
                <div class="form-group">
                    <select id="reg-sex" class="form-select">
                        <option value="">Select Sex Assigned at Birth</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" id="reg-height" class="form-input" placeholder="Height (cm)">
                </div>
                <div class="form-group">
                    <input type="number" id="reg-weight" class="form-input" placeholder="Weight (kg)">
                </div>
                <div class="form-group">
                    <select id="reg-goal" class="form-select">
                        <option value="lose_weight">Lose Weight</option>
                        <option value="gain_muscle">Gain Muscle</option>
                        <option value="maintain">Maintain</option>
                    </select>
                </div>
                <button id="register-btn" class="auth-button">Get Started</button>
                <div class="auth-link">
                    Already have an account? <a href="#" id="show-login">Sign In</a>
                </div>
            </div>
            
            <div id="login-form" class="hidden">
                <h2 class="auth-title">Welcome Back</h2>
                <div class="form-group">
                    <input type="text" id="login-username" class="form-input" placeholder="Username">
                </div>
                <button id="login-btn" class="auth-button">Sign In</button>
                <div class="auth-link">
                    No account? <a href="#" id="show-register">Create Account</a>
                </div>
            </div>
        </div>
    </div>


    <div id="progress-overlay" class="auth-overlay hidden">
            <div class="auth-container progress-page">
                <h2 class="auth-title">Progress</h2>
                <div style="color: rgba(255,255,255,0.6); text-align: center; margin-bottom: 30px;">Track your daily energy and achievements</div>
                
                <div class="progress-section">
                    <div class="energy-balance-header">
                        <div class="energy-balance-main" id="progress-energy-balance">1300 / 2100</div>
                        <div class="time-indicator" id="progress-time">4:40 PM</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-full">
                            <div class="progress-bar-fill" id="progress-energy-fill" style="background: linear-gradient(90deg, #4ade80, #22c55e); width: 62%"></div>
                            <div class="typical-marker" style="left: 65%"></div>
                        </div>
                        <div class="progress-labels">
                            <span>0</span>
                            <span style="color: rgba(255,255,255,0.8);">Typical by now</span>
                            <span>2100</span>
                        </div>
                    </div>
                </div>

                <div class="progress-section">
                    <h3 style="color: white; font-size: 18px; font-weight: 600; margin-bottom: 8px;">What's in your Fuel?</h3>
                    <div style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 15px;">Track your macro nutrients for optimal health</div>
                    
                    <div class="macro-grid">
                        <div class="macro-item">
                            <div class="macro-info">
                                <div class="macro-name">Protein</div>
                                <div class="macro-description">For muscle repair & fullness</div>
                            </div>
                            <div class="macro-progress">
                                <div class="circular-progress">
                                    <svg width="50" height="50">
                                        <circle cx="25" cy="25" r="20" class="circular-progress-bg"></circle>
                                        <circle cx="25" cy="25" r="20" class="circular-progress-fill" style="stroke: #4ade80; stroke-dasharray: 89 126;"></circle>
                                    </svg>
                                    <div class="circular-progress-text">71%</div>
                                </div>
                                <div style="display: flex; flex-direction: column; align-items: flex-end;">
                                    <div class="macro-values">85g/120g</div>
                                    <div class="linear-progress">
                                        <div class="linear-progress-fill" style="background: linear-gradient(90deg, #4ade80, #22c55e); width: 71%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="macro-item">
                            <div class="macro-info">
                                <div class="macro-name">Carbs</div>
                                <div class="macro-description">For energy to move & think</div>
                            </div>
                            <div class="macro-progress">
                                <div class="circular-progress">
                                    <svg width="50" height="50">
                                        <circle cx="25" cy="25" r="20" class="circular-progress-bg"></circle>
                                        <circle cx="25" cy="25" r="20" class="circular-progress-fill" style="stroke: #06b6d4; stroke-dasharray: 103 126;"></circle>
                                    </svg>
                                    <div class="circular-progress-text">82%</div>
                                </div>
                                <div style="display: flex; flex-direction: column; align-items: flex-end;">
                                    <div class="macro-values">180g/220g</div>
                                    <div class="linear-progress">
                                        <div class="linear-progress-fill" style="background: linear-gradient(90deg, #06b6d4, #0891b2); width: 82%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="macro-item">
                            <div class="macro-info">
                                <div class="macro-name">Fats</div>
                                <div class="macro-description">For hormone health & vitamin absorption</div>
                            </div>
                            <div class="macro-progress">
                                <div class="circular-progress">
                                    <svg width="50" height="50">
                                        <circle cx="25" cy="25" r="20" class="circular-progress-bg"></circle>
                                        <circle cx="25" cy="25" r="20" class="circular-progress-fill" style="stroke: #f59e0b; stroke-dasharray: 102 126;"></circle>
                                    </svg>
                                    <div class="circular-progress-text">81%</div>
                                </div>
                                <div style="display: flex; flex-direction: column; align-items: flex-end;">
                                    <div class="macro-values">65g/80g</div>
                                    <div class="linear-progress">
                                        <div class="linear-progress-fill" style="background: linear-gradient(90deg, #f59e0b, #d97706); width: 81%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="auth-button" style="background: linear-gradient(90deg, #4ade80, #22c55e); margin-top: 20px;">
                        + Log Meal
                    </button>
                </div>

                <div class="progress-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h3 style="color: white; font-size: 18px; font-weight: 600; margin-bottom: 4px;">How You Used Your Energy</h3>
                            <div style="color: rgba(255,255,255,0.6); font-size: 14px;">Every movement matters</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #f59e0b; font-size: 14px; font-weight: 600;">‚ö° 550 Cal</div>
                            <div style="color: rgba(255,255,255,0.6); font-size: 12px;">burned today</div>
                        </div>
                    </div>

                    <div class="exercise-list">
                        <div class="exercise-item">
                            <div class="exercise-info">
                                <div class="exercise-icon">üèÉ</div>
                                <div class="exercise-details">
                                    <h4>Running</h4>
                                    <div class="exercise-meta">
                                        <span>3.2 miles</span>
                                        <span>‚Ä¢ 30 min</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
                                <div class="exercise-calories">-350 Cal</div>
                                <div style="display: flex; align-items: center;">
                                    <div style="color: rgba(255,255,255,0.6); font-size: 12px;">New Record!</div>
                                    <div class="pr-badge">üèÜ PR!</div>
                                </div>
                            </div>
                        </div>

                        <div class="exercise-item">
                            <div class="exercise-info">
                                <div class="exercise-icon">üí™</div>
                                <div class="exercise-details">
                                    <h4>Strength Training</h4>
                                    <div class="exercise-meta">
                                        <span>45 min</span>
                                    </div>
                                </div>
                            </div>
                            <div class="exercise-calories">-200 Cal</div>
                        </div>
                    </div>

                    <button class="auth-button" style="background: linear-gradient(90deg, #06b6d4, #0891b2); margin-top: 20px;">
                        + Log Workout
                    </button>
                </div>

                <div class="progress-section">
                    <div class="streak-container">
                        <h3 style="color: white; font-size: 18px; font-weight: 600; margin-bottom: 8px;">Streak</h3>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0;">
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">
                                üî• Current Streak
                            </div>
                            <div style="text-align: right;">
                                <div class="current-streak">5 days</div>
                                <div style="color: rgba(255,255,255,0.6); font-size: 12px;">Best: 12 days</div>
                            </div>
                        </div>

                        <div class="streak-fires">
                            <div class="fire-icon active">üî•</div>
                            <div class="fire-icon active">üî•</div>
                            <div class="fire-icon active">üî•</div>
                            <div class="fire-icon active">üî•</div>
                            <div class="fire-icon active">üî•</div>
                            <div class="fire-icon inactive">üî•</div>
                            <div class="fire-icon inactive">üî•</div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0 10px 0;">
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">
                                üìÖ December Progress
                            </div>
                            <div style="color: #06b6d4; font-size: 14px; font-weight: 600;">27/31 days</div>
                        </div>

                        <div class="calendar-grid">
                            <div class="calendar-header">M</div>
                            <div class="calendar-header">T</div>
                            <div class="calendar-header">W</div>
                            <div class="calendar-header">T</div>
                            <div class="calendar-header">F</div>
                            <div class="calendar-header">S</div>
                            <div class="calendar-header">S</div>
                            
                            <div class="calendar-day completed">1</div>
                            <div class="calendar-day completed">2</div>
                            <div class="calendar-day completed">3</div>
                            <div class="calendar-day completed">4</div>
                            <div class="calendar-day completed">5</div>
                            <div class="calendar-day completed">6</div>
                            <div class="calendar-day completed">7</div>
                            <div class="calendar-day completed">8</div>
                            <div class="calendar-day completed">9</div>
                            <div class="calendar-day completed">10</div>
                            <div class="calendar-day completed">11</div>
                            <div class="calendar-day completed">12</div>
                            <div class="calendar-day completed">13</div>
                            <div class="calendar-day incomplete">14</div>
                            <div class="calendar-day completed">15</div>
                            <div class="calendar-day incomplete">16</div>
                            <div class="calendar-day completed">17</div>
                            <div class="calendar-day today completed">18</div>
                            <div class="calendar-day completed">19</div>
                            <div class="calendar-day completed">20</div>
                            <div class="calendar-day completed">21</div>
                            <div class="calendar-day completed">22</div>
                            <div class="calendar-day completed">23</div>
                            <div class="calendar-day completed">24</div>
                            <div class="calendar-day completed">25</div>
                            <div class="calendar-day completed">26</div>
                            <div class="calendar-day incomplete">27</div>
                            <div class="calendar-day completed">28</div>
                            <div class="calendar-day incomplete">29</div>
                            <div class="calendar-day completed">30</div>
                            <div class="calendar-day completed">31</div>
                        </div>

                        <div class="motivation-quote">
                            "Consistency compounds. Every day you show up builds momentum for tomorrow."
                        </div>
                    </div>
                </div>

                <button class="auth-button secondary" id="back-to-app-from-progress" style="margin-top: 20px;">Back to App</button>
            </div>
        </div>
    <div id="profile-overlay" class="auth-overlay hidden">
            <div class="auth-container">
                <h2 class="auth-title">Profile Settings</h2>
                
                <div class="profile-section">
                    <h3 class="section-title">Personal Information</h3>
                    <div class="profile-avatar">
                        <div class="avatar-circle" id="profile-avatar">
                            <span id="avatar-initial">U</span>
                        </div>
                        <div class="profile-info">
                            <div class="profile-name" id="profile-username">username</div>
                            <div class="profile-email" id="profile-email">user@example.com</div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3 class="section-title">Fitness Profile</h3>
                    <div class="profile-stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Age</div>
                            <div class="stat-value" id="profile-age">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Sex</div>
                            <div class="stat-value" id="profile-sex">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Height</div>
                            <div class="stat-value" id="profile-height">-- cm</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Weight</div>
                            <div class="stat-value" id="profile-weight">-- kg</div>
                        </div>
                    </div>
                    <div class="goal-section">
                        <div class="goal-label">Long-Term Goal</div>
                        <div class="goal-badge" id="profile-goal">maintain</div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="auth-button secondary" id="back-to-app">Back to App</button>
                    <button class="auth-button danger" id="logout-btn">Logout</button>
                </div>
            </div>
        </div>

    <div id="app-container" class="hidden">
        <div class="camera-container">
            <video id="video" autoplay playsinline muted></video>
            <canvas id="canvas"></canvas>
        </div>
        
        <div class="overlay top-overlay">
            <div class="status-bar">
                <div class="time" id="current-time">10:26</div>
                <div class="profile-icon" id="profile-icon"></div>
            </div>
            <div class="calorie-progress">
                <div class="progress-header">
                    <span class="progress-title">Today's Calories</span>
                    <span class="progress-numbers" id="calorie-numbers">1,247 / 2,100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
        </div>
        
        <div class="overlay bottom-overlay">
            <div class="info-card" id="info-card">
                <div class="card-title" id="card-title">
                    Ready to Track
                </div>
                <div class="card-content" id="card-content">
                    Hold the mic button and say "analyze this food" or "log this food"
                </div>
            </div>
            
            <div class="voice-button" id="voice-btn">
                üé§
            </div>
            
            <div class="bottom-nav">
                <div class="nav-item" data-tab="progress"> <div class="nav-icon">üìä</div>
                    <div>Progress</div>
                </div>
                <div class="nav-item active" data-tab="coach">
                    <div class="nav-icon">üí™</div>
                    <div>Coach</div>
                </div>
                <div class="nav-item" data-tab="planner">
                    <div class="nav-icon">üìÖ</div>
                    <div>Planner</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let stream;
        let lastAnalysisResult = null;
        let currentUser = null;
        let currentTab = 'coach';

        // DOM elements
        const authOverlay = document.getElementById('auth-overlay');
        const profileOverlay = document.getElementById('profile-overlay');
        const appContainer = document.getElementById('app-container');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const voiceBtn = document.getElementById('voice-btn');
        const infoCard = document.getElementById('info-card');
        const cardTitle = document.getElementById('card-title');
        const cardContent = document.getElementById('card-content');
        const currentTime = document.getElementById('current-time');
        const calorieNumbers = document.getElementById('calorie-numbers');
        const progressFill = document.getElementById('progress-fill');

        // API config
        const API_BASE = 'http://127.0.0.1:8000';

        // Initialize app
        function init() {
            updateTime();
            setInterval(updateTime, 1000);
            
            const storedUser = localStorage.getItem('fitness-app-user');
            if (storedUser) {
                startApp(storedUser);
            }
            
            setupEventListeners();
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                              now.getMinutes().toString().padStart(2, '0');
            currentTime.textContent = timeString;
        }

        function setupEventListeners() {
            // Auth form switching
            document.getElementById('show-login').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('login-form').classList.remove('hidden');
            });

            document.getElementById('show-register').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
            });

            // Auth buttons
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);

            // Voice button
            voiceBtn.addEventListener('touchstart', startRecording, { passive: true });
            voiceBtn.addEventListener('touchend', stopRecording);
            voiceBtn.addEventListener('mousedown', startRecording);
            voiceBtn.addEventListener('mouseup', stopRecording);

            // Navigation tabs
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => switchTab(item.dataset.tab));
            });

            // Profile icon
            document.getElementById('profile-icon').addEventListener('click', showProfile);

            // Profile page buttons
            document.getElementById('back-to-app').addEventListener('click', hideProfile);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Progress page buttons
            document.getElementById('back-to-app-from-progress').addEventListener('click', hideProgressPage);
            
            setTimeout(() => {
                const logMealBtn = document.querySelector('#progress-overlay .progress-section:nth-of-type(2) .auth-button');
                const logWorkoutBtn = document.querySelector('#progress-overlay .progress-section:nth-of-type(3) .auth-button');
                
                if (logMealBtn) {
                    logMealBtn.addEventListener('click', handleLogMealFromProgress);
                }
                if (logWorkoutBtn) {
                    logWorkoutBtn.addEventListener('click', handleLogWorkoutFromProgress);
                }
            }, 500);
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.tab === tab);
            });
            
            if (tab === 'progress') {
                showProgressPage();
            } else {
                hideProgressPage(false); // Hide progress but don't switch tab back
                updateCardForTab(tab);
            }
        }

        function updateCardForTab(tab) {
            switch(tab) {
                case 'coach':
                    showCard('Ready to Track', 'Hold the mic button and say "analyze this food" or "log this food"');
                    break;
                case 'planner':
                    showCard('Planner+', 'Coming soon - Meal planner, scheduler, and more to help you hit your goals.');
                    break;
            }
        }

        async function showProgressPage() {
            document.getElementById('progress-overlay').classList.remove('hidden');
            document.getElementById('app-container').classList.add('hidden');
            await loadProgressData();
        }

        function hideProgressPage(resetTab = true) {
            document.getElementById('progress-overlay').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            if (resetTab) {
                switchTab('coach');
            }
        }

        async function loadProgressData() {
            if (!currentUser) return;
            
            try {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                document.getElementById('progress-time').textContent = timeString;
                
                const summaryResponse = await fetch(`${API_BASE}/summary`, {
                    headers: { 'X-Username': currentUser }
                });
                
                if (summaryResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    
                    document.getElementById('progress-energy-balance').textContent = 
                        `${summaryData.consumed_today} / ${summaryData.target_calories}`;
                    
                    const percentage = (summaryData.consumed_today / summaryData.target_calories) * 100;
                    document.getElementById('progress-energy-fill').style.width = Math.min(percentage, 100) + '%';
                    
                    const currentHour = now.getHours();
                    const typicalPercentage = Math.min((currentHour / 22) * 100, 100); // Assume day ends at 10pm
                    document.querySelector('.typical-marker').style.left = typicalPercentage + '%';
                }
                
                await updateMacroProgress();
                
            } catch (err) {
                console.error('Failed to load progress data:', err);
            }
        }

        async function updateMacroProgress() {
            try {
                const response = await fetch(`${API_BASE}/macro_summary`, {
                    headers: { 'X-Username': currentUser }
                });

                if (!response.ok) {
                    console.error('Failed to fetch macro summary');
                    return;
                }

                const macros = await response.json();
                const circumference = 2 * Math.PI * 20;

                const updateMacroUI = (macroName, data) => {
                    const circle = document.querySelector(`.macro-item:nth-child(${macroName === 'protein' ? 1 : macroName === 'carbs' ? 2 : 3}) .circular-progress-fill`);
                    const text = document.querySelector(`.macro-item:nth-child(${macroName === 'protein' ? 1 : macroName === 'carbs' ? 2 : 3}) .circular-progress-text`);
                    const values = document.querySelector(`.macro-item:nth-child(${macroName === 'protein' ? 1 : macroName === 'carbs' ? 2 : 3}) .macro-values`);
                    const linear = document.querySelector(`.macro-item:nth-child(${macroName === 'protein' ? 1 : macroName === 'carbs' ? 2 : 3}) .linear-progress-fill`);

                    if (circle) circle.style.strokeDasharray = `${(data.percentage / 100) * circumference} ${circumference}`;
                    if (text) text.textContent = data.percentage + '%';
                    if (values) values.textContent = `${data.current}g/${data.target}g`;
                    if (linear) linear.style.width = data.percentage + '%';
                };

                updateMacroUI('protein', macros.protein);
                updateMacroUI('carbs', macros.carbs);
                updateMacroUI('fats', macros.fats);

            } catch (err) {
                console.error('Error updating macro progress:', err);
            }
        }

        function handleLogMealFromProgress() {
            hideProgressPage();
            showCard('Ready to Log Food', 'Hold the mic button and say "log this food" while pointing at your meal');
        }

        function handleLogWorkoutFromProgress() {
            hideProgressPage();
            showCard('Ready to Log Workout', 'Hold the mic button and say "start my run" or "going for a workout"');
        }

        function showCard(title, content, isFood = false) {
            cardTitle.innerHTML = title;
            if (isFood) {
                cardContent.innerHTML = content;
            } else {
                cardContent.textContent = content;
            }
            infoCard.classList.add('visible');
        }

        function hideCard() {
            infoCard.classList.remove('visible');
        }

        async function startApp(username) {
            currentUser = username.toLowerCase();
            localStorage.setItem('fitness-app-user', username);
            
            authOverlay.classList.add('hidden');
            appContainer.classList.remove('hidden');
            
            switchTab('coach');
            
            await initCamera();
            await updateCalorieProgress();
        }

        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true 
                });
                video.srcObject = stream;
            } catch (err) {
                showCard('Camera Error', 'Camera access denied. Please enable camera permissions.');
            }
        }

        async function updateCalorieProgress() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${API_BASE}/summary`, {
                    headers: { 'X-Username': currentUser }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    calorieNumbers.textContent = `${data.consumed_today} / ${data.target_calories}`;
                    
                    const percentage = (data.consumed_today / data.target_calories) * 100;
                    progressFill.style.width = Math.min(percentage, 100) + '%';
                }
            } catch (err) {
                console.error('Failed to update calorie progress:', err);
            }
        }

        async function startRecording() {
            if (isRecording || !stream) return;
            try {
                audioChunks = [];
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);
                mediaRecorder.onstop = processVoiceCommand;
                mediaRecorder.start();
                isRecording = true;
                voiceBtn.classList.add('listening');
                showCard('Listening...', 'Speak your command now');
            } catch (err) {
                showCard('Microphone Error', err.message);
            }
        }

        function stopRecording() {
            if (!isRecording) return;
            mediaRecorder.stop();
            isRecording = false;
            voiceBtn.classList.remove('listening');
            showCard('Processing...', 'Analyzing your voice command');
        }

        async function processVoiceCommand() {
            if (!currentUser) return;
            try {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const formData = new FormData();
                formData.append('audio', audioBlob, 'voice_command.webm');

                const response = await fetch(`${API_BASE}/voice_command`, {
                    method: 'POST',
                    headers: { 'X-Username': currentUser },
                    body: formData
                });

                const result = await response.json();
                
                switch (result.action) {
                    case 'log_food': await logFoodDirect(); break;
                    case 'analyze_food': await analyzeFood(); break;
                    case 'log_previous': await logPreviousItem(); break;
                    case 'get_summary': await updateCalorieProgress(); break;
                    default: 
                        showCard('Not Understood', result.message || "I didn't understand that. Try saying 'analyze this food' or 'log this food'");
                }
            } catch (err) {
                showCard('Processing Error', 'Voice processing failed. Please try again.');
            }
        }

        async function logFoodDirect() {
            try {
                showCard('Analyzing & Logging...', 'Taking photo and analyzing food');
                const photoBlob = await takePhoto();
                
                const formData = new FormData();
                formData.append('image', photoBlob, 'food.jpg');
                
                const response = await fetch(`${API_BASE}/log_food_direct`, {
                    method: 'POST',
                    headers: { 'X-Username': currentUser },
                    body: formData
                });
                
                const result = await response.json();
                showFoodResult(result, true);
                await updateCalorieProgress();
            } catch (err) {
                showCard('Error', 'Failed to log food. Please try again.');
            }
        }

        async function analyzeFood() {
            try {
                showCard('Analyzing...', 'Taking photo and analyzing food');
                const photoBlob = await takePhoto();
                
                const formData = new FormData();
                formData.append('image', photoBlob, 'food.jpg');
                
                const response = await fetch(`${API_BASE}/analyze_food`, {
                    method: 'POST',
                    headers: { 'X-Username': currentUser },
                    body: formData
                });
                
                const result = await response.json();
                lastAnalysisResult = result;
                showFoodResult(result, false);
            } catch (err) {
                showCard('Error', 'Failed to analyze food. Please try again.');
            }
        }

        function showFoodResult(result, logged) {
            const status = logged ? 'LOGGED' : 'IDENTIFIED';
            const statusIcon = logged ? '‚úÖ' : 'üîç';
            const actionText = logged ? '' : 'Say "log it" to save this to your diary';
            
            const nutritionGrid = `
                <div class="nutrition-grid">
                    <div class="nutrition-item">
                        <div class="nutrition-value">${result.calories}</div>
                        <div class="nutrition-label">calories</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">--g</div>
                        <div class="nutrition-label">protein</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">--g</div>
                        <div class="nutrition-label">carbs</div>
                    </div>
                </div>
                ${actionText ? `<div style="margin-top: 12px; color: #4ade80; font-size: 12px;">${actionText}</div>` : ''}
            `;

            showCard(`${statusIcon} ${status}: ${result.description.toUpperCase()}`, nutritionGrid, true);
        }

        async function logPreviousItem() {
            if (!lastAnalysisResult) {
                showCard('Nothing to Log', 'Please analyze a food item first');
                return;
            }
            
            try {
                await fetch(`${API_BASE}/log_previous`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Username': currentUser
                    },
                    body: JSON.stringify({
                        type: lastAnalysisResult.description.split(' ')[0],
                        description: lastAnalysisResult.description,
                        calories: lastAnalysisResult.calories
                    })
                });
                
                showFoodResult(lastAnalysisResult, true);
                await updateCalorieProgress();
                lastAnalysisResult = null;
            } catch (err) {
                showCard('Error', 'Failed to log item. Please try again.');
            }
        }

        function takePhoto() {
            return new Promise((resolve) => {
                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                canvas.toBlob(resolve, 'image/jpeg', 0.8);
            });
        }

        async function handleRegister() {
            const username = document.getElementById('reg-username').value.toLowerCase().trim();
            const age = document.getElementById('reg-age').value;
            const sex = document.getElementById('reg-sex').value;
            const height = document.getElementById('reg-height').value;
            const weight = document.getElementById('reg-weight').value;
            const goal = document.getElementById('reg-goal').value;

            if (!username || !age || !sex || !height || !weight) {
                alert('Please fill out all fields.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        username, age: parseInt(age), sex, 
                        height_cm: parseInt(height), 
                        weight_kg: parseInt(weight), goal 
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    startApp(result.username);
                } else {
                    const err = await response.json();
                    alert(`Registration failed: ${err.detail}`);
                }
            } catch (err) {
                alert('Registration error occurred.');
            }
        }

        async function handleLogin() {
            const username = document.getElementById('login-username').value.toLowerCase().trim();
            if (!username) {
                alert('Please enter a username.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username })
                });

                if (response.ok) {
                    const result = await response.json();
                    startApp(result.username);
                } else {
                    alert('Login failed: User not found.');
                }
            } catch(err) {
                alert('Login error occurred.');
            }
        }

        function hideProfile() {
            profileOverlay.classList.add('hidden');
        }

        function handleLogout() {
            localStorage.removeItem('fitness-app-user');
            currentUser = null;
            lastAnalysisResult = null;
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            profileOverlay.classList.add('hidden');
            appContainer.classList.add('hidden');
            authOverlay.classList.remove('hidden');
            
            document.getElementById('login-username').value = '';
            document.getElementById('register-form').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
        }

        async function showProfile() {
            if (!currentUser) return;
            
            try {
                profileOverlay.classList.remove('hidden');
                
                const response = await fetch(`${API_BASE}/profile`, {
                    headers: { 'X-Username': currentUser }
                });
                
                if (response.ok) {
                    const profileData = await response.json();
                    
                    document.getElementById('profile-username').textContent = profileData.username;
                    document.getElementById('profile-email').textContent = `${profileData.username}@app.dev`;
                    document.getElementById('profile-age').textContent = profileData.age;
                    document.getElementById('profile-sex').textContent = profileData.sex;
                    document.getElementById('profile-height').textContent = `${profileData.height_cm} cm`;
                    document.getElementById('profile-weight').textContent = `${profileData.weight_kg} kg`;
                    document.getElementById('profile-goal').textContent = profileData.goal.replace('_', ' ');
                    document.getElementById('avatar-initial').textContent = profileData.username.charAt(0).toUpperCase();
                } else {
                    document.getElementById('profile-username').textContent = currentUser;
                    document.getElementById('avatar-initial').textContent = currentUser.charAt(0).toUpperCase();
                }
            } catch (err) {
                console.error('Profile fetch error:', err);
                document.getElementById('profile-username').textContent = currentUser;
                document.getElementById('avatar-initial').textContent = currentUser.charAt(0).toUpperCase();
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>